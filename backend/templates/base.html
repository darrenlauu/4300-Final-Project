<!DOCTYPE html>
<head>
  <title>TVibes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Kanit&family=Montserrat&family=Open+Sans:wght@500&display=swap"
    rel="stylesheet"
  />
  <!-- Font Awesome -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    rel="stylesheet"
  />
  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
    rel="stylesheet"
  />
  <!-- MDB -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.3.0/mdb.min.css"
    rel="stylesheet"
  />
	<!-- Include Select2 CSS -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
	<!-- Include jQuery -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<!-- Include Select2 JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
</head>
<body class="custom-bg">
  <div class="full-body-container">
    <div class="top-text">
      <a href="/"><img src="{{ url_for('static', filename='images/logo.png') }}" /></a>
      <div class="card" style="min-width: 30vw">
        <div class="card-body" style="text-align: center;">
          <div class="input-group">
            <div class="form-outline">
              <input type="search" id="search" class="form-control" onkeyup="if (event.keyCode == 13){filterText()}"/>
              <label class="form-label" for="search">What's your vibe?</label>
            </div>
            <button type="button" class="btn btn-primary" onclick="filterText()">
              <i class="fas fa-search"></i>
            </button>
          </div>
          <div class="input-group">
            <div class="form-outline">
              <select multiple id="select-tags" class="form-control" aria-placeholder="tags">
                <option value="1">Loading</option>
              </select>
            </div>
          </div>
          <div class="input-group">
            <div class="form-outline">
              <select multiple id="select-countries" class="form-control" aria-placeholder="tags">
                <option value="Spain" class="country-option">Spain</option>
                <option value="Netherlands" class="country-option">Netherlands</option>
                <option value="Italy" class="country-option">Italy</option>
                <option value="Italy" class="country-option">United Kingdom</option>
                <option value="Italy" class="country-option">France</option>
              </select>
            </div>
          </div>
          <div class="select-countries">
            <!-- <label>
              <input
                type="checkbox"
                id="select-all-btn"
                class="form-check-input"
                name="countries[]"
                value="Select All"
                checked
              />
              (Select All) </label
            ><br />
            <label>
              <input
                type="checkbox"
                class="form-check-input country-checkbox"
                name="countries[]"
                value="Spain"
                checked
              />
              Spain </label
            ><br />
            <label>
              <input
                type="checkbox"
                class="form-check-input country-checkbox"
                name="countries[]"
                value="Netherlands"
                checked
              />
              Netherlands </label
            ><br />
            <label>
              <input
                type="checkbox"
                class="form-check-input country-checkbox"
                name="countries[]"
                value="Italy"
                checked
              />
              Italy </label
            ><br />
            <label>
              <input
                type="checkbox"
                class="form-check-input country-checkbox"
                name="countries[]"
                value="United Kingdom"
                checked
              />
              United Kingdom </label
            ><br />
            <label>
              <input
                type="checkbox"
                class="form-check-input country-checkbox"
                name="countries[]"
                value="France"
                checked
              />
              France </label
            ><br /> -->
          </div>
          <button type="button" class="btn btn-primary" onclick="filterText()">Search</button>
        </div>
      </div>
      
    </div>
    <div id="answer-box"></div>
  </div>
  <script>
    tag_options = ['breakfast', 'lovely', 'atmosphere', 'fantastic', 'quiet', 'rooms', 'facilities', 'comfy', 'nice', 'modern', 'decor', 'bed', 'beds', 'service', 'perfect', 'really', 'clean', 'attention', 'professional', 'amazing', 'extra', 'buffet', 'accommodating', 'helpful', 'excellent', 'comfort', 'good', 'stylish', 'decoration', 'beautiful', 'comfortable', 'brilliant', 'positive', 'super', 'bathroom', 'best', 'exceptional', 'design', 'near', 'fabulous', 'price', 'easy', 'champagne', 'loved', 'polite', 'victoria', 'upgraded', 'attentive', 'small', 'spacious', 'cleanliness', 'central', 'food', 'vibe', 'feel', 'ideal', 'boutique', 'view', 'kitchenette', 'size', 'location', 'wonderful', 'friendliness', 'royal', 'style', 'area', 'place', 'great', 'reception', 'du', 'croissants', 'new', 'shower', 'underground', 'executive', 'quirky', 'club', 'thing', 'extremely', 'close', 'property', 'kind', 'large', 'friendly', 'hammam', 'superb', 'rooftop', 'charming', 'definitely', 'personal', 'character', 'pool', 'balcony', 'absolutely', 'money', 'exceptionally', 'hospitality', 'spa', 'cozy', 'brand', 'welcoming', 'lobby', 'cookie', 'bar', 'center', 'convenient', 'outstanding', 'restaurant', 'unique', 'overall', 'roof', 'open', 'located', 'ok', 'just', 'delicious', 'big', 'gym', 'room', 'hotel', 'italy', 'courtyard', 'parking', 'shopping', 'value', 'desk', 'quality', 'pillows', 'suite', 'metro', 'connections', 'paris', 'delightful', 'totally', 'old', 'tea', 'help', 'space', 'pleasant', 'employee', 'nearby', 'lock', 'quietness', 'concierge', 'stuff', 'cocktails', 'business', 'luxury', 'baguette', 'canal', 'afternoon', 'helpfull', 'city', 'home', 'treat', 'stay', 'village', 'wifi', 'position', 'gem', 'street', 'real', 'experience', 'special', 'art', 'besi', 'station', 'seine', 'beautifully', 'interior', 'enjoyed', 'gard', 'windows', 'customer', 'mr', 'like', 'free', 'walk', 'couldn', 'restaurants', 'tower', 'swimming', 'cool', 'booking', 'neighborhood', 'republique', 'brasserie', 'newly', 'nicely', 'quite', 'family', 'liked', 'helpfulness', 'public', '10', 'little', 'relaxing', 'night', 'apartment', 'rambla', 'winery', 'kitchen', 'ambience', 'laundry', 'walking', 'cake', 'duomo', 'patrick', 'upgrade', 'awesome', 'distance', 'cosy', 'access', 'familiar', 'st', 'reasonably', 'arra', 'efficient', 'terrace', 'high', 'building', 'trouble', 'maintained', 'decorated', 'thank', 'love', 'class', 'vosges', 'fun', 'calm', 'marais', 'hall', 'shops', 'time', 'theme', 'alcohol', 'safe', 'world', 'cleaning', 'coffee', 'lines', 'renovated', 'complementary', 'smell', 'espanya', 'garden', 'staffs', 'people', 'furniture', 'incredibly', 'tapas', 'views', 'westbahnhof', 'park', 'highly', 'fab', 'vienna', 'concept', 'aswell', 'attractions', 'happy', 'breakfasts', 'centrally', 'fine', 'received', 'lights', 'lounge', 'cooked', 'radio', 'services', 'glass', 'london', 'preserved', 'especially', 'soho', 'cadet', 'court', 'arrival', 'spot', 'tube', 'discreet', 'albert', 'elegant', 'floor', 'recommend', 'star', 'books', 'welcome', 'bit', 'barbican', 'bedding', 'tasty', 'check', 'amenities', 'bright', 'trip', 'lots', 'continental', 'pleasure', 'dinner', 'warm', 'transport', 'priced', 'centre', 'smart', 'tidy', 'look', 'europe', 'given', 'transportation', 'eurostar', 'pleasantries', 'choice', 'day', 'ticket', 'amsterdam', 'selection', 'train', 'neri', 'bars', 'music', 'milan', 'caring', 'armani', 'lot']
    document.getElementById("select-tags").innerHTML = (tag_options.map((tag_el) => ('<option value="' + tag_el + '" class="tag-option">' + tag_el + '</option>'))).join("")
    $(document).ready(function() {
			$('#select-tags').select2({
        placeholder: "Select tags",
        allowClear: true
      });
      $('#select-countries').select2({
        placeholder: "Select countries",
        allowClear: true
      });
		});

    const selectAllBtn = document.getElementById("select-all-btn");
    const countryCheckboxes = document.querySelectorAll(".country-option");

    // selectAllBtn.addEventListener("change", () => {
    //   const checked = selectAllBtn.checked;
    //   for (const checkbox of countryCheckboxes) {
    //     checkbox.checked = checked;
    //   }
    //   filterText();
    // });

    // for (const checkbox of countryCheckboxes) {
    //   checkbox.addEventListener("change", () => {
    //     const allSelected = [...countryCheckboxes].every((cb) => cb.checked);
    //     selectAllBtn.checked = allSelected;
    //     filterText();
    //   });
    // }
  </script>
  <script>
    function getRandomColor() {
      var letters = "0123456789ABCDEF";
      var color = "#";
      for (var i = 0; i < 3; i++) {
        var value = Math.floor(Math.random() * 256);
        var pastelValue = Math.round((value + 255) / 2);
        var hexValue = pastelValue.toString(16).padStart(2, "0");
        color += hexValue;
      }
      return color;
    }

    function answerBoxTemplate(
      hotel_id,
      hotel_name,
      review,
      numVotes,
      country,
      averageScore,
      tags,
      query
    ) {
      var tags_html = tags.map((str, id) => ('<span class="tag btn btn-secondary" style="color: #444444;font-size: 14px;background-color:'+getRandomColor()+'"> ' + str + '</span>'));
      return `<div class='card' data-id=${hotel_id}>
                <div class="card-body">
                  <h5 class="card-title">${hotel_name}</h5></li>
                  <h6 class="card-subtitle mb-2 text-muted">📍 Country: <span style="color: black">${country}</span> </h6>
                  <h6 class="card-subtitle mb-2 text-muted">⭐️ Rating: <span style="color: black">${averageScore}</span> / 10</h6>
                  <h6 class="card-subtitle mb-2 text-muted">🔖 Tags: <div class="tags">${tags_html.join(" ")}</div></h6>
                  <div style="height: 10px"></div>
                  <a class="btn btn-primary btn-lg" href="/${hotel_id}?query=${query}?page_number=1" role="button">View Hotel</a>
                </div>
              </div>`;

              // <div style="text-align:center;margin-top: 20px;"><a class="hotel-button" href="/${hotel_id}?query=${query}">View Hotel</a></div>
      // return `<div class="card">
      //         <div class="card-body">
      //           <h5 class="card-title">Card title</h5>
      //           <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
      //           <button type="button" class="btn btn-primary">Button</button>
      //         </div>
      //       </div>`
    }

    function sendFocus() {
      document.getElementById("filter-text-val").focus();
    }

    function filterText() {
      document.getElementById("answer-box").innerHTML = "";
      const selectedCountryOptions = document.querySelectorAll(
        ".select2-selection__choice"
      );
      // get a list of all checkbox values
      const countryValues = Array.from(selectedCountryOptions).map(
        (option) => option.textContent.substring(1)
      );
      console.log("country values");
      console.log(countryValues);
      // join values by comma into string
      const countryString = countryValues.join(",");
      const query = document.getElementById("search").value;
      fetch(
        "/reviews?" +
          new URLSearchParams({
            query: query,
            countries: countryString,
          }).toString()
      )
        .then((response) => response.json())
        .then((data) => {
          data.forEach((row) => {
            let tempDiv = document.createElement("div");
            tempDiv.innerHTML = answerBoxTemplate(
              row.Hotel_ID,
              row.Hotel_Name,
              row.Positive_Review,
              row.Number_Votes,
              row.Country,
              row.Average_Score,
              [row.Topic_1, row.Topic_2, row.Topic_3, row.Topic_4, row.Topic_5],
              query
            );
            document.getElementById("answer-box").appendChild(tempDiv);
          });
          // if no results, display message
          if (data.length == 0) {
            let tempDiv = document.createElement("div");
            tempDiv.innerHTML = `<div class='card'>
                <div class="card-body">
                  <h5 class="card-title">No results found 🥲</h5></li>
                </div>
              </div>`;
            document.getElementById("answer-box").appendChild(tempDiv);
          }
        });
    }
  </script>
  <script>
    // from https://www.codingnepalweb.com/tags-input-box-html-javascript/
    const ul = document.querySelector("ul"),
      input = document.getElementById("filter-text-val");
    function findTagsAndFilter(e) {
      if (e.keyCode === 13) {
        // addTag(e);
        filterText();
      } 
    }

    // tags = [];
    // createTag();
    // function createTag() {
    //   ul.querySelectorAll("li").forEach((li) => li.remove());
    //   tags
    //     .slice()
    //     .reverse()
    //     .forEach((tag) => {
    //       let liTag = `<li>${tag} <i class="uit uit-multiply" onclick="remove(this, '${tag}'); filterText();"></i></li>`;
    //       ul.insertAdjacentHTML("afterbegin", liTag);
    //     });
    // }
    // function remove(element, tag) {
    //   let index = tags.indexOf(tag);
    //   tags = [...tags.slice(0, index), ...tags.slice(index + 1)];
    //   element.parentElement.remove();
    // }
    // function addTag(e) {
    //   let tag = e.target.value.replace(/\s+/g, " ");
    //   if (tag.length > 1 && !tags.includes(tag)) {
    //     let tags_split = tag.split(",");
    //     if (tags_split.length > 0) {
    //       tags.push(tags_split[0]);
    //       createTag();
    //     }
    //   }
    //   e.target.value = "";
    // }
    // input.addEventListener("keyup", findTagsAndFilter);
  </script>
  <!-- MDB -->
  <script
    type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.3.0/mdb.min.js"
  ></script>
</body>

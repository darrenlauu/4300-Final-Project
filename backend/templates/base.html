<!DOCTYPE html>
<head>
  <title>TVibes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Kanit&family=Montserrat&family=Open+Sans:wght@500&display=swap"
    rel="stylesheet"
  />
  <!-- Font Awesome -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    rel="stylesheet"
  />
  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
    rel="stylesheet"
  />
  <!-- MDB -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.3.0/mdb.min.css"
    rel="stylesheet"
  />
</head>
<body class="custom-bg">
  <div class="full-body-container">
    <div class="top-text">
      <a href="/"><img src="{{ url_for('static', filename='images/logo.png') }}" /></a>
      <div class="card" style="min-width: 30vw">
        <div class="card-body">
          <div class="input-group">
            <div class="form-outline">
              <input type="search" id="search" class="form-control" onkeyup="if (event.keyCode == 13){filterText()}"/>
              <label class="form-label" for="search">What's your vibe?</label>
            </div>
            <button type="button" class="btn btn-primary" onclick="filterText()">
              <i class="fas fa-search"></i>
            </button>
          </div>
          <div class="select-countries">
            <h5 class="card-title">Countries:</h5>
            <label>
              <input
                type="checkbox"
                id="select-all-btn"
                class="form-check-input"
                name="countries[]"
                value="Select All"
                checked
              />
              (Select All) </label
            ><br />
            <label>
              <input
                type="checkbox"
                class="form-check-input country-checkbox"
                name="countries[]"
                value="Spain"
                checked
              />
              Spain </label
            ><br />
            <label>
              <input
                type="checkbox"
                class="form-check-input country-checkbox"
                name="countries[]"
                value="Netherlands"
                checked
              />
              Netherlands </label
            ><br />
            <label>
              <input
                type="checkbox"
                class="form-check-input country-checkbox"
                name="countries[]"
                value="Italy"
                checked
              />
              Italy </label
            ><br />
            <label>
              <input
                type="checkbox"
                class="form-check-input country-checkbox"
                name="countries[]"
                value="United Kingdom"
                checked
              />
              United Kingdom </label
            ><br />
            <label>
              <input
                type="checkbox"
                class="form-check-input country-checkbox"
                name="countries[]"
                value="France"
                checked
              />
              France </label
            ><br />
          </div>
        </div>
      </div>
      
    </div>
    <div id="answer-box"></div>
  </div>
  <script>
    const selectAllBtn = document.getElementById("select-all-btn");
    const countryCheckboxes = document.querySelectorAll(".country-checkbox");

    selectAllBtn.addEventListener("change", () => {
      const checked = selectAllBtn.checked;
      for (const checkbox of countryCheckboxes) {
        checkbox.checked = checked;
      }
      filterText();
    });

    for (const checkbox of countryCheckboxes) {
      checkbox.addEventListener("change", () => {
        const allSelected = [...countryCheckboxes].every((cb) => cb.checked);
        selectAllBtn.checked = allSelected;
        filterText();
      });
    }
  </script>
  <script>
    function getRandomColor() {
      var letters = "0123456789ABCDEF";
      var color = "#";
      for (var i = 0; i < 3; i++) {
        var value = Math.floor(Math.random() * 256);
        var pastelValue = Math.round((value + 255) / 2);
        var hexValue = pastelValue.toString(16).padStart(2, "0");
        color += hexValue;
      }
      return color;
    }

    function answerBoxTemplate(
      hotel_id,
      hotel_name,
      review,
      numVotes,
      country,
      averageScore,
      tags,
      query
    ) {
      var tags_html = tags.map((str, id) => ('<span class="tag btn btn-secondary" style="color: #444444;font-size: 14px;background-color:'+getRandomColor()+'"> ' + str + '</span>'));
      return `<div class='card' data-id=${hotel_id}>
                <div class="card-body">
                  <h5 class="card-title">${hotel_name}</h5></li>
                  <h6 class="card-subtitle mb-2 text-muted">üìç Country: <span style="color: black">${country}</span> </h6>
                  <h6 class="card-subtitle mb-2 text-muted">‚≠êÔ∏è Rating: <span style="color: black">${averageScore}</span> / 10</h6>
                  <h6 class="card-subtitle mb-2 text-muted">üîñ Tags: <div class="tags">${tags_html.join(" ")}</div></h6>
                  <div style="height: 10px"></div>
                  <a class="btn btn-primary btn-lg" href="/${hotel_id}?query=${query}?page_number=1" role="button">View Hotel</a>
                </div>
              </div>`;

              // <div style="text-align:center;margin-top: 20px;"><a class="hotel-button" href="/${hotel_id}?query=${query}">View Hotel</a></div>
      // return `<div class="card">
      //         <div class="card-body">
      //           <h5 class="card-title">Card title</h5>
      //           <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
      //           <button type="button" class="btn btn-primary">Button</button>
      //         </div>
      //       </div>`
    }

    function sendFocus() {
      document.getElementById("filter-text-val").focus();
    }

    function filterText() {
      document.getElementById("answer-box").innerHTML = "";
      const selectedCountryCheckboxes = document.querySelectorAll(
        ".country-checkbox:checked"
      );
      // get a list of all checkbox values
      const countryValues = Array.from(selectedCountryCheckboxes).map(
        (checkbox) => checkbox.value
      );
      // join values by comma into string
      const countryString = countryValues.join(",");
      const query = document.getElementById("search").value;
      fetch(
        "/reviews?" +
          new URLSearchParams({
            query: query,
            countries: countryString,
          }).toString()
      )
        .then((response) => response.json())
        .then((data) => {
          data.forEach((row) => {
            let tempDiv = document.createElement("div");
            tempDiv.innerHTML = answerBoxTemplate(
              row.Hotel_ID,
              row.Hotel_Name,
              row.Positive_Review,
              row.Number_Votes,
              row.Country,
              row.Average_Score,
              [row.Topic_1, row.Topic_2, row.Topic_3, row.Topic_4, row.Topic_5],
              query
            );
            document.getElementById("answer-box").appendChild(tempDiv);
          });
          // if no results, display message
          if (data.length == 0) {
            let tempDiv = document.createElement("div");
            tempDiv.innerHTML = `<div class='card'>
                <div class="card-body">
                  <h5 class="card-title">No results found ü•≤</h5></li>
                </div>
              </div>`;
            document.getElementById("answer-box").appendChild(tempDiv);
          }
        });
    }
  </script>
  <script>
    // from https://www.codingnepalweb.com/tags-input-box-html-javascript/
    const ul = document.querySelector("ul"),
      input = document.getElementById("filter-text-val");
    function findTagsAndFilter(e) {
      if (e.keyCode === 13) {
        // addTag(e);
        filterText();
      } 
    }

    // tags = [];
    // createTag();
    // function createTag() {
    //   ul.querySelectorAll("li").forEach((li) => li.remove());
    //   tags
    //     .slice()
    //     .reverse()
    //     .forEach((tag) => {
    //       let liTag = `<li>${tag} <i class="uit uit-multiply" onclick="remove(this, '${tag}'); filterText();"></i></li>`;
    //       ul.insertAdjacentHTML("afterbegin", liTag);
    //     });
    // }
    // function remove(element, tag) {
    //   let index = tags.indexOf(tag);
    //   tags = [...tags.slice(0, index), ...tags.slice(index + 1)];
    //   element.parentElement.remove();
    // }
    // function addTag(e) {
    //   let tag = e.target.value.replace(/\s+/g, " ");
    //   if (tag.length > 1 && !tags.includes(tag)) {
    //     let tags_split = tag.split(",");
    //     if (tags_split.length > 0) {
    //       tags.push(tags_split[0]);
    //       createTag();
    //     }
    //   }
    //   e.target.value = "";
    // }
    // input.addEventListener("keyup", findTagsAndFilter);
  </script>
  <!-- MDB -->
  <script
    type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.3.0/mdb.min.js"
  ></script>
</body>
